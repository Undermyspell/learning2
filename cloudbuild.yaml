steps:
    - name: "gcr.io/cloud-builders/docker"
      args: ["build", "-t", "eu.gcr.io/$PROJECT_ID/$_ANGULARSERVICE", "--build-arg", "env=production", "-f", "./angular/Dockerfile.Gcloud", "./angular"]
  
    - name: "gcr.io/cloud-builders/docker"
      args: ["push", "eu.gcr.io/$PROJECT_ID/$_ANGULARSERVICE"]
  
    - name: "gcr.io/cloud-builders/gcloud"
      args: ["run", "deploy", "$_ANGULARSERVICE",
             "--platform", "managed", "--region", "europe-west1",
             "--allow-unauthenticated",
             "--image",  "eu.gcr.io/$PROJECT_ID/$_ANGULARSERVICE"]
             
    - name: "gcr.io/cloud-builders/gcloud"
      args: ["run", "service", "update-traffic", "--to-latest"]

images:
    - "eu.gcr.io/$PROJECT_ID/$_ANGULARSERVICE"